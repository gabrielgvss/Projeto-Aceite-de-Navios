<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="/static/css/relatorio.css" />
    <link rel="stylesheet" href="/static/css/sidebar.css" />
    <link rel="stylesheet" href="/static/css/header.css" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <title>Solicitar</title>
  </head>
  <body>
    <div class="header" id="header">
      <div class="logo">
        <a href="/"><img src="/static/img/logo_sana.png" alt="Logo SANA" id="img_logo" /></a>
      </div>
    </div>

    <div class="container-fluid">
      <!-- Left Sidebar -->
      <div class="menutoggle active">
        <div id="toggle-btn">
          <img src="../static/img/menu.svg" alt="" class="bx bx-menu" id="header-toggle" style="cursor: pointer" />
        </div>
      </div>
      <nav class="sidebar">
        <div class="sidebar-header">
          <h3 class="menu_header">MENU</h3>
        </div>
        <ul class="list">
          <li>
            <a href="/perfil-user"><img src="../static/img/key.svg" alt="" class="mx-3" /> Editar Senha de Acesso</a>
          </li>
          <li>
            <a href="/ajuda"><img src="../static/img/ajuda.svg" alt="" class="mx-3" /> Ajuda</a>
          </li>
          <li>
            <a href="/suporte">
              <img src="../static/img/suporte.png" alt="" class="mx-3" />
              Suporte
            </a>
          </li>
          <li>
            <a href="/login"><img src="../static/img/sair.svg" alt="" class="mx-3" /> Sair</a>
          </li>
        </ul>
      </nav>
    </div>
    <div class="container shadow-lg rounded-3 py-2 px-4 justify-content-md-center w-50">
      <div class="row justify-content-md-center">
        <div class="col-6">
          <div class="input-group w-100 mx-auto my-2">
            <input id="campoPesquisa" type="text" class="form-control" placeholder="Pesquisar por nome" />
            <div class="input-group-prepend">
              <button id="btn-pesq" class="btn btn-primary rounded-0 rounded-end" onclick="pesquisar()">Pesquisar</button>
            </div>
          </div>
        </div>
        <div class="col-6 py-2">
          <select id="ordenarPor" name="" class="form-select w-100">
            <option value="" disabled selected>Ordenar por:</option>
            <option value="opcao1">Ordem Alfabética de Nome</option>
            <option value="opcao2">Posição</option>
          </select>
        </div>
      </div>
      <table id="tabelaBody" class="table table-striped mx-auto justify-content-md-center">
        <thead class="thead-dark">
          <tr>
            <th>#</th>
            <th>Nome do Navio</th>
            <th>Ação</th> <!-- Corrigido aqui -->
          </tr>
        </thead>
        <tbody>
          {% for navio in navios %}  <!-- Corrigido aqui -->
          <tr class="linha" style="cursor: pointer; user-select: none">
            <td class="col-2 py-3">{{ navio.id_navio }}</td>
            <td class="col-5 py-3">{{ navio.nome }}</td>
            <td class="col-5">
              <form id="form-solicitar-{{ navio.id_navio }}" method="POST" action="/processar_solicitacao/{{ navio.id_navio }}">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="_method" value="PUT">
                <input type="hidden" name="id_navio" value="{{ navio.id_navio }}">
                <button type="submit" class="btn btn-outline-primary aceite" onclick="enviarFormulario('{{ navio.id_navio }}')">Solicitar Aceite</button>
            </form>
            
            
              
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      <p id="nEncontrado" style="display: none; font-weight: bold">Navio não encontrado</p>
    </div>
    <script src="../static/js/site/script.js"></script>
    <script>
      function enviarFormulario(idNavio) {
        var mensagem = `Solicitação de aceite para o navio com ID ${idNavio} foi enviada.`;
        console.log(mensagem); // Adicionando mensagem de log
        
        var options = {
            method: 'PUT', // Especifica o método PUT
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ id_navio: idNavio })
        };
    
        fetch(`/processar_solicitacao/${idNavio}`, options)
            .then(response => {
                console.log("Status da resposta:", response.status);
                if (!response.ok) {
                    throw new Error('Erro ao processar a solicitação');
                }
                return response.json();
            })
            .then(data => {
                // Faça algo com os dados da resposta, se necessário
            })
            .catch(error => {
                console.error('Erro:', error);
            });
    }
    
    </script>
  </body>
</html>
